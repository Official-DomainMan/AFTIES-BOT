generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model LastLetterState {
  guildId    String @id
  channelId  String
  lastWord   String
  lastLetter String?
  usedWords  String[]
  updatedAt  DateTime @updatedAt

  // ðŸ”¥ New streak fields
  currentStreak Int @default(0)
  bestStreak    Int @default(0)
}

model CountingState {
  guildId    String   @id
  channelId  String
  current    Int      @default(0)
  lastUserId String?
  updatedAt  DateTime @updatedAt
}

model CountingUserStat {
  guildId   String
  userId    String
  points    Int      @default(0)
  lastCount DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@id([guildId, userId])
}

model PhoneGuyConfig {
  guildId      String @id
  channelId    String?
  logChannelId String?
  updatedAt    DateTime @updatedAt
}

model PhoneGuyOptIn {
  guildId   String
  userId    String
  createdAt DateTime @default(now())

  @@id([guildId, userId])
}

model PhoneGuyQueue {
  id        String   @id @default(cuid())
  userId    String
  guildId   String
  mode      String   // "global"
  createdAt DateTime @default(now())
}

model PhoneGuyCall {
  id        String   @id @default(cuid())
  userAId   String
  guildAId  String
  userBId   String
  guildBId  String
  mode      String   // "local" | "global"
  status    String   @default("active") // "active" | "ended"
  startedAt DateTime @default(now())
  endedAt   DateTime?
}

model PhoneGuyBlock {
  blockerId String
  blockedId String
  createdAt DateTime @default(now())

  @@id([blockerId, blockedId])
}

model PhoneGuyCooldown {
  userId    String @id
  lastStart DateTime
}

model PhoneGuyLog {
  id        String   @id @default(cuid())
  type      String   // "queue_join" | "match" | "end" | "say"
  mode      String?  // "local" | "global"
  callId    String?
  guildId   String?
  userId    String?
  otherUserId String?
  message   String?
  createdAt DateTime @default(now())
}

model ModConfig {
  guildId      String   @id
  logChannelId String?
  updatedAt    DateTime @updatedAt
}

model Infraction {
  id        String   @id @default(cuid())
  guildId   String
  userId    String
  modId     String
  type      String   // "warn" | "timeout" | "kick" | "ban" | "purge" | "note"
  reason    String?
  meta      Json?
  createdAt DateTime @default(now())
  expiresAt DateTime?

  @@index([guildId, userId, createdAt])
  @@index([guildId, createdAt])
}

model ModPolicy {
  guildId              String   @id
  warnExpiresDays      Int      @default(30)
  warnWindowDays       Int      @default(7)
  autoTimeoutWarnCount Int      @default(3)
  autoTimeoutMinutes   Int      @default(60)

  dmOnWarn             Boolean  @default(false)
  dmOnAutoTimeout      Boolean  @default(false)

  updatedAt            DateTime @updatedAt
}
model LastLetterScore {
  id        Int      @id @default(autoincrement())
  guildId   String
  userId    String
  score     Int      @default(0)
  updatedAt DateTime @updatedAt

  @@unique([guildId, userId])
}
model LevelProfile {
  guildId     String
  userId      String
  xp          Int      @default(0)
  level       Int      @default(0)
  lastXpAt    DateTime?

  @@id([guildId, userId])
  @@index([guildId, xp(sort: Desc)])
}
model LevelRoleReward {
  guildId String
  level   Int
  roleId  String

  @@id([guildId, level])
}
model LevelRole {
  guildId      String
  roleId       String
  requiredLevel Int

  created DateTime @default(now())

  @@id([guildId, roleId])
}